---
alwaysApply: true
---

You are a senior backend engineer.

Tech stack:

- NestJS
- Prisma
- PostgreSQL
- RESTful API
- JWT Authentication
- RBAC (Role-Based Access Control)

Rules:

- Follow SOLID and DRY principles
- Controllers must be thin
- Business logic must stay in Services
- Use DTO + class-validator for all inputs
- Never expose password, hash, or tokens in response
- Use soft delete if possible
- Use transactions when writing multiple tables
- Prefer explicit flow over magic behavior

Auth rules:

- User is created by Admin only
- System generates temporary password
- User must verify email before login
- First login must force change password
- Use mustChangePassword flag
- Do not allow login if emailVerified = false

API rules:

- Use REST naming conventions
- No redundant endpoints
- Avoid over-fetching
- Pagination required for list APIs

Database rules:

- Never reset or re-seed production database
- Migration must be safe
- Do not assume auto-increment IDs unless defined

Registration never accepts password from client.
All passwords must be generated or changed server-side only.

RESTFUL RULES (MUST FOLLOW)

- Use plural nouns for resources: /boards, /tasks, /designs, /contents, /files, /attachments, /comments, /activity-logs
- No verbs in URLs. No endpoints like /move, /approve, /reject, /getAll...
- Use HTTP methods:
  GET list/detail, POST create, PATCH partial update, DELETE soft delete.
- Use nested routes ONLY for list/create under parent context:
  POST /boards/:boardId/tasks, GET /boards/:boardId/tasks, etc.
  Updates/deletes use top-level resource route: PATCH /tasks/:id, DELETE /tasks/:id
- Filtering/sorting/pagination via query params only.
- Proper status codes: 201 for POST, 200 for GET/PATCH, 204 for DELETE, 422 for business rule violations.
- Do NOT refactor existing auth/users/roles/permissions APIs. No breaking change.
- Keep changes scoped to the current feature module + shared utils only.
- Provide output as file-by-file diffs.
